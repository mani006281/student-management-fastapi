<!DOCTYPE html>
<html>
<head>
    <title>Login & Register</title>
    <meta charset="UTF-8">

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #1e293b, #2563eb);
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
}

.container {
    background: white;
    padding: 40px;
    width: 350px;
    border-radius: 10px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.25);
}

h2 {
    text-align: center;
    margin-bottom: 20px;
    color: #1e293b;
}

h3 {
    margin-bottom: 10px;
    color: #334155;
}

input {
    width: 100%;
    padding: 10px;
    margin-bottom: 15px;
    border-radius: 6px;
    border: 1px solid #ccc;
    outline: none;
    transition: 0.3s;
}

input:focus {
    border-color: #2563eb;
    box-shadow: 0 0 6px rgba(37,99,235,0.5);
}

button {
    width: 100%;
    padding: 10px;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    font-weight: bold;
    transition: 0.3s;
}

.register-btn {
    background: #16a34a;
    color: white;
}

.register-btn:hover {
    background: #15803d;
}

.login-btn {
    background: #2563eb;
    color: white;
}

.login-btn:hover {
    background: #1e40af;
}

#message {
    margin-top: 15px;
    text-align: center;
    font-weight: bold;
}

hr {
    margin: 25px 0;
    border: none;
    border-top: 1px solid #ddd;
}
</style>

</head>

<body>

<div class="container">

<h2>Student Management System</h2>

<h3>Register</h3>
<input type="text" id="reg_username" placeholder="Username">
<input type="password" id="reg_password" placeholder="Password">
<button class="register-btn" onclick="register()">Register</button>

<hr>

<h3>Login</h3>
<input type="text" id="login_username" placeholder="Username">
<input type="password" id="login_password" placeholder="Password">
<button class="login-btn" onclick="login()">Login</button>

<p id="message"></p>

</div>

<script>

/* âœ… UPDATED PRODUCTION API URL */
const API_URL = "https://student-management-fastapi-vlwc.onrender.com";

/* ---------- REGISTER ---------- */
async function register() {
    try {
        const username = document.getElementById("reg_username").value.trim();
        const password = document.getElementById("reg_password").value.trim();
        const msg = document.getElementById("message");

        if (!username || !password) {
            msg.style.color = "red";
            msg.innerText = "Please fill all fields";
            return;
        }

        const res = await fetch(`${API_URL}/auth/register`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ username, password })
        });

        const data = await res.json();

        if (res.ok) {
            msg.style.color = "green";
            msg.innerText = "Registration successful. Now login.";
        } else {
            msg.style.color = "red";
            msg.innerText = data.detail || JSON.stringify(data);
        }
    } catch (err) {
        alert("Backend not reachable.");
        console.error(err);
    }
}

/* ---------- LOGIN ---------- */
async function login() {
    try {
        const username = document.getElementById("login_username").value.trim();
        const password = document.getElementById("login_password").value.trim();
        const msg = document.getElementById("message");

        if (!username || !password) {
            msg.style.color = "red";
            msg.innerText = "Please enter username and password";
            return;
        }

        const body = new URLSearchParams();
        body.append("username", username);
        body.append("password", password);

        const res = await fetch(`${API_URL}/auth/login`, {
            method: "POST",
            headers: {
                "Content-Type": "application/x-www-form-urlencoded"
            },
            body: body
        });

        const data = await res.json();

        if (res.ok) {
            localStorage.setItem("token", data.access_token);
            msg.style.color = "green";
            msg.innerText = "Login successful!";
            setTimeout(() => {
                window.location.href = `${API_URL}/dashboard`;
            }, 800);
        } else {
            msg.style.color = "red";
            msg.innerText = data.detail || "Login failed";
        }
    } catch (err) {
        alert("Login failed. Check console.");
        console.error(err);
    }
}

</script>

</body>
</html>